function SimpleApiListSource(n,t,i){var r=this;this.options={allowPaging:i.allowPaging||!1,pagingMode:i.pagingMode||"default",allowSorting:i.allowSorting||!1,allowSearching:i.allowSearching||!1,allowDelete:i.allowDelete||!1,enableMetadataLookup:i.enableMetadataLookup||!1,topButtonsTemplate:i.topButtonsTemplate||"",rowButtonsTemplate:i.rowButtonsTemplate||"rowButtonsTemplate.html",pagingTemplate:i.pagingMode=="append"?"appendPagingTemplate.html":"defaultPagingTemplate.html"},this.columnDefs=i.columnDefs,this.rowClick=i.rowClick||function(){},this.newItem={},this.items=[],this.pagingOptions={pageSizes:[10,50,100],pageSize:i.itemsPerPage||10,currentPage:1,pageCount:-1,pagerPages:[1]},this.itemCount=0,this.sort=i.sort||{},this.lastQuery="",this.filterOptions={filterText:"",useExternalFilter:!0},this.loading=!1,this.metaData=[],this.forNgGrid=function(n,t){return r.data=t+".items",r.totalServerItems=t+".itemCount",r.showFooter=!0,r.enablePaging=!0,n.$watch(t+".pagingOptions",function(n,t){n!==t&&(n.currentPage!==t.currentPage||n.pageSize!==t.pageSize)&&r.loadIn(100)},!0),n.$watch(t+".filterOptions.filterText",function(n,t){n!==t&&(r.pagingOptions.currentPage=1,r.loadIn(300))},!0),r},this.applyMetadata=function(){for(var t,u,n,i=0;i<r.metaData.length;i++)for(t=r.metaData[i],u=0;u<r.columnDefs.length;u++)n=r.columnDefs[u],n.field==t.Name&&(n.metaData=t,n.dataType==null&&(n.dataType=t.TypeUsageName.toLowerCase()),n.displayName==null&&t.DisplayName!=null&&(n.displayName=t.DisplayName),n.displayName==null&&(n.displayName=n.field),n.cellFilter==null&&n.dataType=="double"&&(n.cellFilter="number:2"),n.cellFilter==null&&n.dataType=="datetime"&&(n.cellFilter="date:shortDate"))},this.loadMetadata=function(){return t.get(n+"/meta").success(function(n){r.metaData=n,r.applyMetadata()})},this.loadTimer=null,this.loadIn=function(n,t){r.loading=!0,window.clearTimeout(this.loadTimer),r.loadTimer=window.setTimeout(function(){r.load(t)},n)},this.TryParseInt=function(n,t){var i=t;return n!=null&&n.length>0&&(n=n.replace(",",""),isNaN(n)||(i=parseInt(n))),i},this.TryParseFloat=function(n,t){var i=t;return n!=null&&n.length>0&&(n=n.replace(",",""),isNaN(n)||(i=parseFloat(n))),i},this.TryParseDate=function(n,t){var r=t,i;return n!=null&&n.length>0&&(i=Date.parse(n),isNaN(i)||(r=new Date(i))),r},this.getTypedFilter=function(n){return n==null||n==""?{}:{asDate:r.TryParseDate(n),asInt:r.TryParseInt(n),asFloat:r.TryParseFloat(n),asText:n}},this.getSearchODataFilter=i.getSearchODataFilter||function(n){for(var i=r.getTypedFilter(n),u=[],t,f=0;f<r.columnDefs.length;f++){if(t=r.columnDefs[f],i.asDate&&t.dataType=="datetime"){var e=(new Date).getTimezoneOffset()*6e4,o=new Date(Date.parse(n+" 0:00")+e),s=new Date(Date.parse(n+" 23:00")+e);u.push(t.field+" gt datetime'"+o.toISOString()+"' and "+t.field+" lt datetime'"+s.toISOString()+"'")}i.asFloat&&t.dataType=="double"&&u.push("floor("+t.field+") eq floor("+i.asFloat.toFixed(2)+") or ceiling("+t.field+") eq ceiling("+i.asFloat.toFixed(2)+")"),i.asFloat&&t.dataType=="int32"&&u.push(t.field+" eq "+i.asFloat.toFixed(0)),i.asText&&t.dataType=="string"&&u.push("substringof('"+i.asText+"',"+t.field+") eq true")}return u.join(" or ")},this.toggleSort=function(n){var t=r.sort[n];t==null?r.sort[n]="":t==""?r.sort[n]="desc":t=="desc"&&delete r.sort[n],r.load()},this.getSortOData=function(){var t=[],n;for(n in this.sort)t.push(n+" "+this.sort[n]);return t.join(",")},this.loadNewItem=function(){t.get(n+"/new").success(function(n){r.newItem=n})},this.addMany=function(i){return t.post(n+"/many",i).success(function(){r.load()})},this.add=function(i){var u=i||r.newItem;return t.post(n,u).success(function(){i==null&&r.loadNewItem(),r.load()})},this.update=function(i){return t.put(n,i).success(function(){})},this.delete=function(i){t.delete(n,{data:i}).success(function(){var n=r.items.indexOf(i);n!=-1&&r.items.splice(n,1)})},this.confirmDelete=function(n,t){confirm(n)&&r.delete(t)},this.goToPage=function(n){r.pagingOptions.currentPage=n},this.firstPage=function(){r.pagingOptions.currentPage=1},this.nextPage=function(){r.pagingOptions.currentPage<r.pagingOptions.pageCount&&(r.pagingOptions.currentPage=r.pagingOptions.currentPage+1)},this.previousPage=function(){r.pagingOptions.currentPage>1&&(r.pagingOptions.currentPage=r.pagingOptions.currentPage-1)},this.lastPage=function(){r.pagingOptions.currentPage=r.pagingOptions.pageCount},this.getPageInterval=function(n,t,i){var r=t/2;return{start:Math.ceil(n>r?Math.max(Math.min(n-r,i-t),1):1),end:Math.ceil(n>r?Math.min(n+r-1,i):Math.min(t,i))}},this.load=function(u){var f,e,o,s,c,h;return r.loading=!0,f=[],i.allowPaging&&(f.push("$inlinecount=allpages"),f.push("$skip="+(r.pagingOptions.currentPage-1)*r.pagingOptions.pageSize),f.push("$top="+r.pagingOptions.pageSize)),i.allowSorting&&(e=r.getSortOData(),e!=null&&e!=""&&f.push("$orderby="+e)),o=[],i.allowSearching&&(s=r.getSearchODataFilter(r.filterOptions.filterText),s!=null&&s!=""&&o.push("("+s+")")),o.length>0&&(c="$filter="+o.join(" and "),f.push(c)),h=n+"/?"+f.join("&"),r.lastQuery=h,t.get(h).then(function(n){var i=n.data,e,f,t;if(u==!0)for(t=0;t<i.Results.length;t++)e=i.Results[t],r.items.push(e);else r.items=i.Results;if(r.itemCount=i.Count,r.options.allowPaging)for(r.pagingOptions.pageCount=Math.ceil(r.itemCount/r.pagingOptions.pageSize),r.pagingOptions.pagerPages=[],f=r.getPageInterval(r.pagingOptions.currentPage,10,r.pagingOptions.pageCount),t=f.start;t<=f.end;t++)r.pagingOptions.pagerPages.push(t);r.loading=!1},function(){r.loading=!1})},this.init=function(){t.defaults.headers.delete={"Content-Type":"application/json"},t.defaults.headers.get={"Content-Type":"application/json"},r.options.enableMetadataLookup?r.loadMetadata().then(r.load):r.load(),r.loadNewItem()},this.init()}function SimpleApiFormSource(n,t,i){var r=this;this.modelState={},this.item={},this.loading=!1,this.saving=!1,this.isNew=!1,this.load=function(){i!=null?(r.getById(),r.save=r.update,r.isNew=!1):(r.getNew(),r.save=r.add,r.isNew=!0)},this.getById=function(){return r.loading=!0,t.get(n+"/"+i).success(function(n){r.item=n,r.loading=!1}).error(function(){r.loading=!1})},this.getNew=function(){t.get(n+"/new").success(function(n){r.item=n})},this.update=function(){return r.saving=!0,t.put(n,r.item).success(function(n){r.modelState={},r.item=n,r.saving=!1,r.onSave&&r.onSave()}).error(function(n){r.modelState=n.ModelState,r.saving=!1})},this.add=function(){return r.saving=!0,t.post(n,r.item).success(function(n){r.modelState={},r.item=n,r.saving=!1,r.onSave&&r.onSave()}).error(function(n){r.modelState=n.ModelState,r.saving=!1})},this.load()}
//@ sourceMappingURL=SimpleEntityApi.min.js.map